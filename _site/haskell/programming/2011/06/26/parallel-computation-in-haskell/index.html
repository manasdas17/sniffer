<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="None worth writing.">
    <title>Parallel Computation in Haskell</title>
    <meta name="author" content="Dilawar Singh" />
    <link rel="stylesheet" href="https://github.com/themes/minimal/stylesheets/styles.css">
 <style>
      header { zoom: 1.0; width: 150px}
      header h1 { margin-bottom: 5px; }
      header h1 a { color: #494949; font-weight: bold; }
      header h3 { margin-top: 20px; margin-bottom: 5px; }
      header p.view { margin-bottom: 5px; }
      header p.view small { padding-top: 2px; }
      header ul {
        zoom: 0.7;
        margin-top: 25px;
      }
      section { width: 600px }
      section p { margin-top: 10px; }
      section h1 { margin-bottom: 15px; }
      section h2 { margin-bottom: 10px; }
      section h2 { margin-bottom: 10px; }
      footer { bottom: 20px; }
      footer p { margin-bottom: 5px; }
      .half-width {
        float: left;
        width: 100px;
        list-style: none;
        padding: 5px;
        margin: 7px;
        margin-bottom: 10px;
      }
      .half-width h4 {
        margin-bottom: 5px;
      }
      .half-width ul {
        padding-left: 0;
      }
      .half-width ul li {
        list-style: inside;
        font-size: 15px;
      }
      .clear-fix {
        clear: both;
      }
    </style>
    <script src="https://github.com/themes/minimal/javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
</head>

<body>
    <div class="wrapper">
        <header>
        <h1><a href="/">Notes</a></h1>
        <p class="view"> <img src= "http://dilawar.github.io/images/pic_enhanced.jpg"
            alt="dilawar" height="150" width="150" /> </p>
        <p class="view"><a href="/projects/index.html">Open Source Projects <small>Might be useful to you</small></a></p>
        <p class="view"><a target="_blank"
            href="http://www.cen.iitb.ac.in/">Masters<small>Microelectronics and
                VLSI</small></a> 
        </p>
        <p class="view"><a target="_blank"
            href="http://www.ee.iitb.ac.in/~hpc">Ph. D.</a><small>Abandoned
            after 3 years</small>
        </p>
        <p class="view"><a target="_blank"
            href="http://www.ncbs.res.in/bhalla">Research Fellow <small>Moose,
                The Neural Simulator</small> </a> 
        </p>
        <p class="view"><a target="_blank"
            href="http://dilawarrajput.wordpress.com">Blog <small>This much I
                know</small></a> 
        </p>

        
        </header>

        <footer>
        </footer>

    <section id="post">
    <h1>Parallel Computation in Haskell </h1>
<div class="content">
  <p>A parallel program is an multi-threaded program designed to work on a multi-processor of multi-core processor. You will be a moron to write a multi-threaded program for a single-core processor. Doing this will not only reduce the performance but also make the program unnecessarily complicated.</p>

<p>In multi-threaded programs, each thread do some computationally extensive tasks in parallel with other thread. Ideally, one should design these tasks to be sent to different cores to be equally time consuming else one thread has to wait till other finishes. These are complicated issues and problems in program design.</p>

<p>Haskell is a different language. Unlike most of the other languages, the thread is not created when we demands. Rather a <strong>spark</strong> is created. This spark is changed into threads when the <em>Haskell Run Time</em> system finds that a unit in CPU is free and can be utilized. <em>par</em> and <em>pseq</em> are immensely useful for making your thread behave in a way you like.</p>

<p>This blog is not a tutorial. For tutorial purpose, one has have a look at this discussion <a href="http://stackoverflow.com/questions/2763864/multithreaded-haskell">thread</a>. I personally recommend tutorial by Satnam and Jones.</p>

<p>Here is a code with which you can play around. This code is taken from the tutorial.</p>

<p>[sourcecode language="scala"]
import Control.Parallel
import System.Time</p>

<p>{--- FUNCTION
 - Following function take a number and return its Fibonacci series number.
 -}
fib :: Int -> Int
fib 0 = 0
fib 1 = 1
fib n = fib (n-1) + fib (n-2)</p>

<p>{-
 - Another function which takes a list and create a list of corresponding
 - Fibonacci series number.
 - NOTE : For tutorial purpose, [1..28] is a good value.
 -}
fibList :: [Int] -> [Int]
fibList [] = []
fibList (x:xs) = fib x : fibList (xs)</p>

<p>{--- FUNCTION
 - Another function is sumEuler function which returns the number of element in
 - a list which are co-prime to the a number (in our case, it is the largest
 - number in the list.
 -}</p>

<p>mkList :: Int -> [Int]
mkList n = [1..n-1] -- there is no need to test upto the last element.</p>

<p>coprime :: Int -> Int -> Bool
coprime x y = gcd x y == 1</p>

<p>euler :: Int -> Int
euler  n=  length . filter (coprime n) $ mkList n</p>

<p>sumEuler :: Int -> Int
sumEuler = sum . (map euler) . mkList</p>

<p>{--- FUNCTION
 -}
sumFibEuler :: Int -> Int -> Int
sumFibEuler a b = fib a + sumEuler b</p>

<p>{--- FUNCTION
 - This function is a parallel version of above function, sumFibEuler.
 -}
parSumFibEuler :: Int -> Int -> Int
parSumFibEuler a b</p>

<pre><code>=   par f (pseq e (e + f)) where -- It says compute (f + e) with f sparked off!
    f = fib a
    e = sumEuler b
</code></pre>

<p>{--- FUNTION
 - Performance measurement functions.
 -}
secDiff :: ClockTime -> ClockTime -> Float
secDiff (TOD sec1 psec1) (TOD sec2 psec2)</p>

<pre><code>= fromInteger (psec2 - psec1) / 1e12 + fromInteger (sec2 - sec1)
</code></pre>

<p>r1 :: Int
r1 = parSumFibEuler 38 5300</p>

<p>r2 :: Int
r2 = fib 38</p>

<p>r3 :: Int
r3 = sumEuler 5300</p>

<p>main :: IO ()
main
  = do</p>

<pre><code>t0 &lt;- getClockTime
pseq r1 (return ())
t1 &lt;- getClockTime
putStrLn ("Sum: " ++ show r1)
putStrLn ("Time: " ++ show (secDiff t0 t1) ++ " seconds")
</code></pre>

<p>{-RESULTS
 - On my machine with Intel i3 (2 core processors, following results were
 - obtained.
 -
 - fib 38 took 22.36 sec
 - sumEuler took 20.67 seconds
 - parSumFibEuler took approx 41 seconds.
 - IRRESPECTIVE OF CHANGE MADE IN main .
 -}
[/sourcecode]</p>

</div>

<div id="related">
  <h2>Related Posts</h2>
  <ul class="posts">
    
      <li> <a href="/numerical%20computation/2014/01/30/Coding-With-Floats/">Coding with float</a></li>
    
      <li> <a href="/noguinomousenoproblem/2014/01/29/Using-mutt/">Using mutt, saving password and writing mail in markdown</a></li>
    
      <li> <a href="/[%22tutorial%22,%20%22literate%20programming%22]/2013/10/30/Python-frontend-for-noweb/">Python front-end for Noweb literate tool</a></li>
    
  </ul>
</div>

<script type="text/javascript"
    src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
    </script>

<!-- Google analytic -->
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-47774588-1', 'dilawar.github.io');
    ga('send', 'pageview');
</script>

<div id="comment">
  
  <div id="disqus_thread"></div>
  <script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  var disqus_shortname = 'dilawarblog'; // required: replace example with your forum shortname

  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function() {
   var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
   dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
   (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
   })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

</div>



    </section>

    <!-- Latex in post -->
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <!-- Google analytic -->
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-47774588-1', 'dilawar.github.io');
        ga('send', 'pageview');
    </script>
</body>
</html>
