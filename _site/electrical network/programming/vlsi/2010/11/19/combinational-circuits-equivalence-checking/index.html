<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="None worth writing.">
    <title>Combinational circuits - Equivalence checking</title>
    <meta name="author" content="Dilawar Singh" />
    <link rel="stylesheet" href="https://github.com/themes/minimal/stylesheets/styles.css">
 <style>
      header { zoom: 1.0; width: 150px}
      header h1 { margin-bottom: 5px; }
      header h1 a { color: #494949; font-weight: bold; }
      header h3 { margin-top: 20px; margin-bottom: 5px; }
      header p.view { margin-bottom: 5px; }
      header p.view small { padding-top: 2px; }
      header ul {
        zoom: 0.7;
        margin-top: 25px;
      }
      section { width: 600px }
      section p { margin-top: 10px; }
      section h1 { margin-bottom: 15px; }
      section h2 { margin-bottom: 10px; }
      section h2 { margin-bottom: 10px; }
      footer { bottom: 20px; }
      footer p { margin-bottom: 5px; }
      .half-width {
        float: left;
        width: 100px;
        list-style: none;
        padding: 5px;
        margin: 7px;
        margin-bottom: 10px;
      }
      .half-width h4 {
        margin-bottom: 5px;
      }
      .half-width ul {
        padding-left: 0;
      }
      .half-width ul li {
        list-style: inside;
        font-size: 15px;
      }
      .clear-fix {
        clear: both;
      }
    </style>
    <script src="https://github.com/themes/minimal/javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
</head>

<body>
    <div class="wrapper">
        <header>
        <h1><a href="/">Notes</a></h1>
        <p class="view"> <img src= "http://dilawar.github.io/images/pic_enhanced.jpg"
            alt="dilawar" height="150" width="150" /> </p>
        <p class="view"><a href="/projects/index.html">Open Source Projects <small>Might be useful to you</small></a></p>
        <p class="view"><a target="_blank"
            href="http://www.cen.iitb.ac.in/">Masters<small>Microelectronics and
                VLSI</small></a> 
        </p>
        <p class="view"><a target="_blank"
            href="http://www.ee.iitb.ac.in/~hpc">Ph. D.</a><small>Abandoned
            after 3 years</small>
        </p>
        <p class="view"><a target="_blank"
            href="http://www.ncbs.res.in/bhalla">Research Fellow <small>Moose,
                The Neural Simulator</small> </a> 
        </p>
        <p class="view"><a target="_blank"
            href="http://dilawarrajput.wordpress.com">Blog <small>This much I
                know</small></a> 
        </p>

        
        </header>

        <footer>
        </footer>

    <section id="post">
    <h1>Combinational circuits - Equivalence checking </h1>
<div class="content">
  <p>Given a VLSI entity and its two description, establishing if both of them are equivalent is fundamental problem in VLSI verification. In this post, I am going to give describe an small part of this problem. Lets say someone has provided us with an behavioral description of an entity. For example lets say the given behavior of this entity is following.</p>

<p>[caption id="attachment_255" align="aligncenter" width="326" caption="a, b, c, and d are input to this entity and e is output."]<a href="http://dilawarnotes.files.wordpress.com/2010/11/untitleddocument1.png"><img src="http://dilawarnotes.files.wordpress.com/2010/11/untitleddocument1.png" alt="" /></a>[/caption]</p>

<p>Lets say if $latex a = 1$ and $latex b =1$ then $latex c = c \otimes d$ and if $latex a = 1$ and $latex b = 0$ then $latex e = c \bar{\otimes} d$. Otherwise, I don't give a damn!</p>

<p>Ok! Now I have to give a hardware description of this entity else no would care about it. I give the following VHDL description (I hate verilog!).</p>

<p>[sourcecode language="text"]</p>

<p>-- This is the entity</p>

<p>entity Cblock is</p>

<pre><code>port(a,b,c,d: in bit; e: out bit);
</code></pre>

<p>end entity Cblock;</p>

<p>-- this is the specification</p>

<p>architecture Behave of Cblock is</p>

<p>begin process(a,b,c,d)</p>

<p>begin</p>

<pre><code> if(a = '1' and b = '1') then
</code></pre>

<p>e &lt;= c xor d;</p>

<p>elsif (a = '1' and b = '0') then</p>

<p>e &lt;= c xnor d;</p>

<p>else</p>

<p>end if;</p>

<p>end process;</p>

<p>end Behave;</p>

<p>[/sourcecode]</p>

<p>Next task is to find an equivalent circuit description of this behavior. We can surely use some synthesizer but they are not smart enough. Sometimes they produce garbage (though this case is way too simple to make a synthesizer go mad.). We are going to build our own. <strong>We introduce one more condition, say a, c, and d can never be same at any time. So we can treat them as don't care condition. </strong>Lets make the truth table of Cblock.</p>

<p>[caption id="attachment_270" align="aligncenter" width="630" caption="First table shows the truth table. Second shows truth table after don't cares and third shows the minimization process. Note that blue color is being overlapped by other one. We have three min terms here."]<a href="http://dilawarnotes.files.wordpress.com/2010/11/truthtables.png"><img src="http://dilawarnotes.files.wordpress.com/2010/11/truthtables.png" alt="" /></a>[/caption]</p>

<p>After minimization, Cblock can be written as $latex e = b \bar{c}\bar{d} + abd + abc$.  Notice that since $latex a, c, d$ are not allowed to be same at any given time. We have  $latex \bar{a}{b}\bar{c}\bar{d}$, $latex \bar{a}\bar{b}\bar{c}\bar{d}$, $latex abdc$, $latex {a}\bar{b}{c}{d}$ should not be taken into accout i.e. don't care conditions.</p>

<h3>Build the circuit</h3>

<p>Lets our life more miserable. We say that we have only <strong>AND </strong>and <strong>NOT </strong>gates available. Can we realise the given function $latex e$. Yes we can, remember that <strong>AND </strong>and <strong>NOT </strong>together represents <a href="http://en.wikipedia.org/wiki/NAND_logic"><strong>NAND </strong>which is universal gate</a> and others gates can be realised using it.</p>

<p>Now we can construct the following circuit.</p>

<p>[caption id="attachment_271" align="aligncenter" width="630" caption="Circuit representing the function in Qucs."]<a href="http://dilawarnotes.files.wordpress.com/2010/11/circuit.png"><img src="http://dilawarnotes.files.wordpress.com/2010/11/circuit.png" alt="" /></a>[/caption]</p>

<p>This circuit can be simulated in any circuit simulator like <strong>ngspice.</strong> If you are using <strong>Qucs </strong>than you can use the following file. Since I can not attach this type of file, here is the code.</p>

<h2>Verify both implementation</h2>

<p>Now the final task to is to verify whether out implementation matches with the given behaviour. To verify, I must check my implementation for all the possible input combination and output must match the given bahviorial description. We use <strong>VHDL</strong> to describe our implementation and then we make a test-bench to verify it. Following is the code for testbench. All entities are given in a single file.</p>

<p>[sourcecode language="text"]</p>

<p>-- VHDL file for assignment 06.</p>

<p>-- Dilawar Singh</p>

<p>-- dilawar@ee.iitb.ac.in</p>

<p>-- Modified from its original version.</p>

<p>-- GHDL is used to compile it.</p>

<p>-- AND GATE</p>

<p>entity And2 is</p>

<p>  port(a,b: in bit; c: out bit);</p>

<p>end entity And2;
architecture Behave of And2 is
begin</p>

<p>  c &lt;= a and b;</p>

<p>end Behave;</p>

<p>-- Invertor</p>

<p>entity Inv is</p>

<p>  port(a: in bit; b: out bit);</p>

<p>end entity Inv;</p>

<p>architecture Behave of Inv is</p>

<p>begin</p>

<p>  b &lt;= not a;</p>

<p>end Behave;</p>

<p>-- This is the entity</p>

<p>entity Cblock is</p>

<p>  port(a,b,c,d: in bit; e: out bit);</p>

<p>end entity Cblock;</p>

<p>-- this is the specification</p>

<p>architecture Behave of Cblock is</p>

<p>begin</p>

<p>  process(a,b,c,d)</p>

<p>  begin</p>

<pre><code> if(a = '1' and b = '1') then

    e &amp;lt;= c xor d;

 elsif (a = '1' and b = '0') then

    e &lt;= c xnor d;

 else

 end if;
</code></pre>

<p>  end process;</p>

<p>end Behave;</p>

<p>-- this is the implementation which you have to write.</p>

<p>-- you may assume that the dont care set is a=c=d</p>

<p>architecture Impl of Cblock is</p>

<pre><code>component And2 is port(a,b: in bit; c: out bit); end component;

component Inv is port(a: in bit; b: out bit); end component;

-- fill in your implementation

-- declare signals for interconnecting your gates
</code></pre>

<p>  signal i1_out, i2_out, i3_out, i4_out, i5_out, i6_out, i7_out, i8_out : bit;</p>

<p>  signal a1_out, a2_out, a3_out, a4_out, a5_out, a6_out : bit;</p>

<p>begin</p>

<p>  -- fill in your implementation</p>

<pre><code>-- instantiate your gates.

i1 : Inv port map(a =&gt; c, b =&gt; i1_out);

i2 : Inv port map(a =&gt; d, b =&gt; i2_out);

i3 : Inv port map(a =&gt; c, b =&gt; i3_out);

i4 : Inv port map(a =&gt; d, b =&gt; i4_out);

i5 : Inv port map(a =&gt; a1_out, b =&gt; i5_out);

i6 : Inv port map(a =&gt; b, b =&gt; i6_out);

i7 : Inv port map(a =&gt; a4_out, b =&gt; i7_out);

i8 : Inv port map(a =&gt; a5_out, b =&gt; i8_out);

i9 : Inv port map(a =&gt; a6_out, b =&gt; e);

a1 : And2 port map(i1_out, i2_out, a1_out);

a2 : And2 port map(a, b, a2_out);

a3 : And2 port map(i3_out, i4_out, a3_out);

a4 : And2 port map(i5_out, a2_out, a4_out);

a5 : And2 port map(i6_out, a3_out, a5_out);

a6 : And2 port map(i7_out, i8_out, a6_out);
</code></pre>

<p>end Impl;</p>

<p>entity Testbench is
end entity Testbench;</p>

<p>-- testbench</p>

<p>architecture Compare of Testbench is</p>

<pre><code>signal a,b,c,d,eref,edut: bit;

type bV2 is array(natural range &lt;&gt;) of bit_vector(3 downto 0);

-- legal patterns.

constant pattern: bV2(0 to 11) :=

    (

        ('0','0','0','1'),

        ('0','0','1','0'),

        ('0','0','1','1'),

        ('0','1','0','1'),

        ('0','1','1','0'),

        ('0','1','1','1'),

        ('1','0','0','0'),

        ('1','0','0','1'),

        ('1','0','1','0'),

        ('1','1','0','0'),

        ('1','1','0','1'),

        ('1','1','1','0'));
</code></pre>

<p>component Cblock is port(a,b,c,d: in bit; e: out bit); end component;
for ref:Cblock  use entity work.Cblock(behave);</p>

<pre><code>for dut:Cblock  use entity work.Cblock(behave); -- use impl when ready
</code></pre>

<p>begin</p>

<p>   ref: Cblock port map(a=>a,b=>b,c=>c,d=>d,e=>eref);</p>

<p>   -- change to implementation when you have one ready</p>

<p>   dut: Cblock port map(a=>a,b=>b,c=>c,d=>d,e=>edut);</p>

<p>   process</p>

<pre><code>variable I : integer := 0;
</code></pre>

<p>   begin</p>

<pre><code>while I &amp;lt; 12 loop

    a &amp;lt;= pattern(I)(3); b &amp;lt;= pattern(I)(2); c &amp;lt;= pattern(I)(1); d  &amp;lt;= pattern(I)(0);

    I := I+1;

    wait for 1 ns;

    assert(eref = edut) report "Mismatch between Reference and DUT" severity error;

end loop;

assert false report &amp;quot;Test Over&amp;quot; severity note;

wait;
</code></pre>

<p>   end process;</p>

<p>end Compare;</p>

<p>[/sourcecode]</p>

<h2>Results</h2>

<p>Now we have to run this testbench. There are few VHDL simulator available, one is ghdl. We are going to use this. Make sure you can ghdl installed. You can get it from<a href="http://ghdl.free.fr/"> here</a>. Now we have to run following commands.</p>

<p><code>$ghdl -a filename.vhd</code></p>

<p><code>$ghdl -e testbench</code></p>

<p><code>$ghdl -r testbench --vcd=filename.vcd</code></p>

<p>Since my filename was <code>dilawar.vhd</code> I got following output.</p>

<p><code>dilawar.vhdl:118:8:@12ns:(assertion note):Test Over</code></p>

<p>Note that since we have exhausted all the possible combination of inputs. This is not possible in big circuits with a lot of inputs. Simulation is too slow to handle all the cases. In future, we’ll be in need of better formal verification tools. About that some other day.</p>

<p>[caption id="attachment_287" align="aligncenter" width="630" caption="Waveform of both of the implementation. Note that for given input combinations, output is same. Thats is what an engineer establishes for equivalence."]<a href="http://dilawarnotes.files.wordpress.com/2010/11/wave.png"><img src="http://dilawarnotes.files.wordpress.com/2010/11/wave.png" alt="" /></a>[/caption]</p>

</div>

<div id="related">
  <h2>Related Posts</h2>
  <ul class="posts">
    
      <li> <a href="/numerical%20computation/2014/01/30/Coding-With-Floats/">Coding with float</a></li>
    
      <li> <a href="/noguinomousenoproblem/2014/01/29/Using-mutt/">Using mutt, saving password and writing mail in markdown</a></li>
    
      <li> <a href="/[%22tutorial%22,%20%22literate%20programming%22]/2013/10/30/Python-frontend-for-noweb/">Python front-end for Noweb literate tool</a></li>
    
  </ul>
</div>

<script type="text/javascript"
    src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
    </script>

<!-- Google analytic -->
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-47774588-1', 'dilawar.github.io');
    ga('send', 'pageview');
</script>

<div id="comment">
  
  <div id="disqus_thread"></div>
  <script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  var disqus_shortname = 'dilawarblog'; // required: replace example with your forum shortname

  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function() {
   var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
   dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
   (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
   })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

</div>



    </section>

    <!-- Latex in post -->
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <!-- Google analytic -->
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-47774588-1', 'dilawar.github.io');
        ga('send', 'pageview');
    </script>
</body>
</html>
